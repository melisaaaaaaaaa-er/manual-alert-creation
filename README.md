# Manual Alert Creation

<h2>Purpose</h2>

- Configure security incident alerts manually.
- Trigger alert and view logs

Make sure windows-vm is powered on for this lab.

#
<h3>Configure the Alert in Microsoft Sentinel</h3>

<img src="https://raw.githubusercontent.com/melisaaaaaaaaa-er/manual-alert-creation-images/main/1.png"/>

Navigate to Microsoft Sentinel → LAW → Analytics → + Create → Scheduled query rule.

<img src="https://raw.githubusercontent.com/melisaaaaaaaaa-er/manual-alert-creation-images/main/2.png"/>

Give the rule a name and description. Select "Next".

<img src="https://raw.githubusercontent.com/melisaaaaaaaaa-er/manual-alert-creation-images/main/2.5.png"/>

Input the following KQL query in the Rule Query box:

SecurityEvent

| where EventID == 4625

| where TimeGenerated > ago(60m)

| summarize FailureCount = count() by AttackerIP = IpAddress, EventID, Activity, DestinationHostName = Computer

| where FailureCount >= 10

Select "Next".

<img src="https://raw.githubusercontent.com/melisaaaaaaaaa-er/manual-alert-creation-images/main/3.png"/>

In Alert Enhancement, expand the "Entity mapping" dropdown menu and select "+ Add new entity". 

Configure the following entities:
- IP

- Host

Entities are used to correlated incidents within Sentinel. This allows us to see if the same attacker is going after more than one service in Azure.

<img src="https://raw.githubusercontent.com/melisaaaaaaaaa-er/manual-alert-creation-images/main/4.png"/>

Configure query scheduling. 

This allows us to choose how often to run the query and from how far back in the data logs to analyze from.

<img src="https://raw.githubusercontent.com/melisaaaaaaaaa-er/manual-alert-creation-images/main/5.png"/>

Configure alert threshold.

This is the quantity of results the query should generate before in alert is made.

<img src="https://raw.githubusercontent.com/melisaaaaaaaaa-er/manual-alert-creation-images/main/6.png"/>

Select "group all events into a single alert", then "Next".

#
<img src="https://raw.githubusercontent.com/melisaaaaaaaaa-er/manual-alert-creation-images/main/7.png"/>

<img src="https://raw.githubusercontent.com/melisaaaaaaaaa-er/manual-alert-creation-images/main/8.png"/>

Enable alert grouping into incidents

#
<img src="https://raw.githubusercontent.com/melisaaaaaaaaa-er/manual-alert-creation-images/main/9.png"/>

Here is the alert rule just configured.

#
<h3>Triggering the Alert and Analyzing Queries</h3>

<img src="https://raw.githubusercontent.com/melisaaaaaaaaa-er/manual-alert-creation-images/main/10.png"/>

There are initially no results generated by the query.

#
<img src="https://raw.githubusercontent.com/melisaaaaaaaaa-er/manual-alert-creation-images/main/12.png"/>

Trigger the alert by trying to log on to windows-vm with faulty credentials.

#
<img src="https://raw.githubusercontent.com/melisaaaaaaaaa-er/manual-alert-creation-images/main/13.png"/>

<img src="https://raw.githubusercontent.com/melisaaaaaaaaa-er/manual-alert-creation-images/main/14.png"/>

Here are the results of the query. Not all of these are the trigger attempt just made. A lot of these are real logon attemts from the Internet.

NOTE: it can take a few hours for the query results to start showing.

#

Delete the alert rule.
